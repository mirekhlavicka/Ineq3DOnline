{"name":"Bottle\\Wine Jug","x0":-1.0,"y0":-1.0,"z0":-1.0,"x1":1.0,"y1":1.0,"z1":1.0,"maxDivisionCount":12,"quality":false,"curvatureQuality":false,"formula":"[advanced]\r\n\r\nprivate double Bump(double x)\r\n{\r\n  if (x <= -1 || x >= 1)\r\n    return 0.0;\r\n\r\n  double t = 1 - x * x;      // 1 - x^2\r\n  return Math.Exp(-1 / t) / Math.Exp(-1);  // normalized so f(0) = 1\r\n}\r\n\r\nstatic\tdouble[] z =  { -1,   -0.5, 0,   0.5,   1 };\r\nstatic\tdouble[] rz = { 0.55, 0.85, 0.55,0.3, 0.4  };\r\n  \r\nprivate\tFunc<double,double> rf = Interpolation.CubicSpline(z,rz);\r\n  \r\nstatic\tdouble[] a =  { -PI, -PI + 0.5, -PI/2, 0, PI /2, PI - 0.5, PI };\r\nstatic\tdouble[] fa = {  1,  0.4     ,  1,     1, 1,     0.4,     1  };\r\n  \r\nprivate\tFunc<double,double> angf = Interpolation.CubicSpline(a,fa);\r\n\r\n\r\nprivate IneqTree Mug(double dr = 0)\r\n{\r\n  \tFuncXYZ f = (x,y,z) => \r\n    {\r\n      \tvar b = Bump((z-1));\r\n      \tvar aa = atan2(y,x);\r\n      \r\n      \tvar r0 = rf(z);\r\n\t\t\r\n      \tvar af = 1 - pow(abs(angf(aa) - 1), 2 - 0.5 * b);\r\n      \r\n\t\tvar r = (b * af + 1 - b) * r0 - dr;\r\n      \r\n\t\treturn x*x + y*y - r;      \r\n    };\r\n  \t\r\n  \treturn f & (# -z +(-1 + dr)  ) ;\r\n}\r\n\r\nprivate IneqTree Grape(double z0)\r\n{\r\n\tvar res = new IneqTree();\r\n  \r\n  \tint[] c = {3, 4, 3, 2, 1} ;\r\n  \r\n  \tdouble da = PI / 14;\r\n  \tdouble dz = 0.12;\r\n  \tdouble sa = -PI/2;\r\n\t\r\n  \tfor(int i=0; i < c.Length; i++)\r\n    {\r\n\t  double z = z0 - i * dz;\t\t\t      \r\n      for(int j = 0; j < c[i]; j++)\r\n      {\r\n          double a = sa + j * da;\r\n        \r\n\t\t  double f = 0.99 + 0.06 * i * j * (c.Length - 1 - i) * (c[i] - 1 - j) / 3;\t        \t\r\n        \r\n          double x = f * sqrt(rf(z)) * cos(a);\r\n          double y = f * sqrt(rf(z)) * sin(a);\r\n          res = res | Ball(x, y, z, 0.12);\r\n        \r\n          if(i ==0 & j==1)\r\n          {\r\n            double x1 = f * sqrt(rf(z + 0.25)) * cos(a);\r\n            double y1 = f * sqrt(rf(z + 0.25)) * sin(a);\r\n\r\n            res = res | Cylinder(x, y, z + 0.05, x1, y1, z + 0.25,  0.06).ToFunc(0.03);  \r\n          }\r\n      }\r\n      sa += (i==0 ? -da/2 : da/2);\r\n    }\r\n  \r\n\treturn res;\r\n}\r\n\r\npublic IneqTree TorusPQ(double x0, double y0, double z0, double r, double R)\r\n{\r\n\r\n    var res = new IneqTree((x, y, z) =>\r\n    {\r\n\t\tdouble p, q;\r\n\r\n      \tx = x - x0;\r\n        y = y - y0;\r\n        z = z - z0;      \r\n\r\n      \tp = z < 0 ? 2 : 2.5;\r\n      \tq = 4;\r\n      \r\n      \tdouble pn = pow(pow(abs(x), p) + pow(abs(z), p), 1.0d/p);\r\n      \r\n      \tdouble sx =  R * x / pn;\r\n      \tdouble sz =  R * z / pn;\r\n\r\n\t\tdouble v = sqrt((x-sx)*(x-sx) + (z-sz)*(z-sz));\r\n      \r\n      \treturn pow(pow(y, q) + pow(1.5*v, q), 1.0/q) - r;\r\n\r\n    });\r\n  \r\n  \tres.Transform(delegate(ref double x, ref double y, ref double z) \r\n    {\r\n\t\tz -= (x)/4;      \r\n    });\r\n  \r\n  \treturn res;\r\n}\r\n\r\n\r\npublic IneqMesh GetIneqMesh()\r\n{\r\n    return new IneqMesh\r\n    {\r\n        X0 = -1.1,\r\n        Y0 = -1.1,\r\n        Z0 = -1.1,\r\n        X1 = 1.5,\r\n        Y1 = 1.1,\r\n        Z1 = 1.3,\r\n        D = 0.07d,\r\n        Boxed = false,\r\n        IneqTree = //((TorusPQ(0.73, 0, 0.2, 0.15, 0.5) | Mug() | Grape(0.15)) & !Mug(0.05)) & (# z - 1) \r\n          //Mug() | Grape(0.1)\r\n          //Mug() & (# z - 1)\r\n          //TorusPQ(0.63, 0, 0.1, 0.1, 0.5) | (Mug() & (# z - 1)) \r\n          \r\n          ((TorusPQ(0.63, 0, 0.1, 0.1, 0.5) | (Mug() & (# z - 1) ) | Grape(0.15)) & !Mug(0.05)) \r\n      };\r\n}\r\n"}